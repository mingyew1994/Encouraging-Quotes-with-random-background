<script>
  // ---- Config ----
  const TOTAL_IMAGES = 18;              // image_1.jpg … image_18.jpg
  const USE_CACHE_BUST = false;         // flip to true if browser caches too hard
  const INTERVAL_MS = 5000;             // change every 5 seconds
  const IMAGE_PREFIX = 'image_';
  const IMAGE_EXT = '.jpg';

  let order = [];       // shuffled indices, e.g., [7, 3, 15, ...]
  let cursor = 0;       // where we are in the shuffled list
  let timerId = null;

  // Respect reduced motion
  const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  // Fisher–Yates shuffle
  function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function newOrder() {
    order = shuffle(Array.from({ length: TOTAL_IMAGES }, (_, i) => i + 1));
    cursor = 0;
  }

  function nextFromOrder() {
    if (order.length === 0 || cursor >= order.length) newOrder();
    return order[cursor++];
  }

  function pickNextImage() {
    const i = nextFromOrder();
    const base = `${IMAGE_PREFIX}${i}${IMAGE_EXT}`;
    return USE_CACHE_BUST ? `${base}?v=${Date.now()}` : base;
  }

  function setPhoto(src) {
    const img = document.getElementById('photo');

    // Preload for smooth swap
    const pre = new Image();
    pre.onload = () => {
      img.style.opacity = '0';
      requestAnimationFrame(() => {
        img.src = pre.src;
        requestAnimationFrame(() => { img.style.opacity = '1'; });
      });
    };
    pre.onerror = () => {
      // If an image is missing, skip it and advance to the next one
      setPhoto(pickNextImage());
    };
    pre.src = src;
  }

  function setNextPhoto() {
    setPhoto(pickNextImage());
  }

  function startSlideshow() {
    if (prefersReducedMotion) return;
    stopSlideshow();
    timerId = setInterval(setNextPhoto, INTERVAL_MS);
  }

  function stopSlideshow() {
    if (timerId !== null) {
      clearInterval(timerId);
      timerId = null;
    }
  }

  // Pause when tab is hidden; resume when visible
  document.addEventListener('visibilitychange', () => {
    if (document.hidden) stopSlideshow();
    else startSlideshow();
  });

  // Optional: tiny refresh on orientation change
  window.addEventListener('orientationchange', () => {
    const img = document.getElementById('photo');
    img.style.transform = 'translateZ(0)';
    setTimeout(() => { img.style.transform = ''; }, 200);
  });

  // ---- Quotes (unchanged) ----
  async function loadQuote() {
    const quoteEl = document.getElementById("quote");
    const authorEl = document.getElementById("author");
    const errEl = document.getElementById("error");

    try {
      const res = await fetch("quotes.json");
      if (!res.ok) throw new Error("File not found");

      const quotes = await res.json();
      const idx = Math.floor(Math.random() * quotes.length);
      const q = quotes[idx];

      quoteEl.textContent = q.quote;
      authorEl.textContent = q.author ? "— " + q.author : "";
    } catch (e) {
      quoteEl.textContent = "⚠️ Unable to load quotes.";
      authorEl.textContent = "";
      errEl.textContent = "Make sure quotes.json is in the same folder as index.html.";
    }
  }

  // ---- Init ----
  newOrder();       // create the first shuffled cycle
  setNextPhoto();   // show the first image from the order
  loadQuote();
  startSlideshow(); // then rotate every 5s
</script>
